html, body{ overflow-x: hidden; }

/* Hide scrollbars globally */
::-webkit-scrollbar {
  width: 0;
  height: 0;
}

body {
  overflow-y: scroll; /* keeps layout stable (no shift when toggling) */
  scrollbar-width: none; /* Firefox */
}

/* Force sidebar-aware centering for the Add/Edit modal only */
.ws-card.ws-modal.ws-center-over-content{
  position: fixed;
  /* same math as rel: center of (viewport - sidebar) */
  left: var(--content-center-left, calc(var(--sidebar-w, 0px) + (100svw - var(--sidebar-w, 0px))/2));
  top: 50%;
  transform: translate(-50%, -50%) !important;
  right: auto !important;
  z-index: 600;

  /* fluid width that never invades the sidebar */
  --dlg-gutter-l: clamp(8px, 2vw, 18px);
  --dlg-gutter-r: clamp(32px, 6vw, 72px);
  --dlg-max-inline: calc(100svw - var(--sidebar-w, 0px) - var(--dlg-gutter-l) - var(--dlg-gutter-r));
  --modal-maxw: clamp(480px, 56svw, 760px);

  width: min(clamp(260px, 64svw, var(--modal-maxw)), var(--dlg-max-inline)) !important;
  max-height: min(78svh, 580px);
  overflow: auto;
}
@media (900px <= width <= 1280px){
  .ws-card.ws-modal.ws-center-over-content{ --dlg-gutter-r: clamp(40px, 7vw, 84px); }
}
@media (max-width: 420px){
  :root{ --modal-maxw: 480px; }
}

/* hide native number spinners */
.rel-num[type="number"]::-webkit-outer-spin-button,
.rel-num[type="number"]::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }
.rel-num[type="number"]{ -moz-appearance: textfield; }

/* stepper wrapper */
.rel-stepper{
  position: relative;
  display: inline-flex;
  align-items: center;
}

/* input with room for buttons */
.rel-stepper .rel-num{
  padding-right: 48px;                 /* space for the stacked buttons */
  width: 110px;                        /* a bit wider for balance */
  height: 40px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(18,22,30,.75);
  color: #E9EEF7;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
}
[data-theme="light"] .rel-stepper .rel-num{
  background: rgba(255,255,255,.92); color:#0f1320; border-color: rgba(0,0,0,.12);
}

/* vertical +/- buttons */
.rel-step{
  position: absolute; right: 6px;
  width: 32px; height: 18px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color: #E9EEF7;
  border-radius: 8px;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  display: inline-flex; align-items: center; justify-content: center;
  cursor: pointer;
  transition: transform .08s ease, background .15s ease, border-color .15s ease;
}
.rel-step:hover{ background: rgba(255,255,255,.12); }
.rel-step:active{ transform: translateY(1px); }

.rel-step.up{  top: 6px; }
.rel-step.down{ bottom: 6px; }

/* chevron icons */
.rel-step.up::before,
.rel-step.down::before{
  content:"";
  width: 8px; height: 8px;
  border: 2px solid currentColor;
  border-left: 0; border-bottom: 0;
}
.rel-step.up::before{ transform: rotate(-45deg); }
.rel-step.down::before{ transform: rotate(135deg); }

[data-theme="light"] .rel-step{
  background: rgba(0,0,0,.06); color:#0f1320; border-color: rgba(0,0,0,.12);
}

/* center the weight rows (from earlier) */
.rel-weight{
  display:flex; align-items:center; gap:10px;
  width: fit-content; margin: 6px auto; justify-content: center;
}



/* --- Edge weight arrows (robust, consolidated) --- */
.rel-panel .rel-dir{
  display:flex; align-items:center; gap:10px;
  margin: 6px 0;
}

/* arrow length = flex-basis + min-width */
.rel-panel .rel-line{
  display:block;
  flex: 1 1 560px;     /* ← default desired length; increase for longer (e.g., 640px) */
  min-width: 450px;    /* ← shortest allowed on small screens */
  height: 2px;
  background: currentColor;
  position: relative;
  opacity:.9;
}

.rel-panel .rel-line::after{
  content:"";
  position:absolute; top:50%;
  width:10px; height:10px;
  border:2px solid currentColor;
  border-left:0; border-bottom:0;
  transform-origin:50% 50%;
}

.rel-panel .rel-to-right::after{ right:-1px; transform: translateY(-50%) rotate(45deg); }
.rel-panel .rel-to-left::after { left:-1px;  transform: translateY(-50%) rotate(-135deg); }

[data-theme="dark"]  .rel-panel .rel-line{ background: rgba(255,255,255,.9); }
[data-theme="light"] .rel-panel .rel-line{ background: rgba(15,18,32,.9); }

/* weight rows + chips + inputs (unchanged) */
.rel-weight{ display:flex; align-items:center; gap:10px;
  width: fit-content;          /* shrink to contents */
  margin: 6px auto;            /* <-- centers the whole row */
  justify-content: center;     /* keeps chip + input centered as a group */ }
.rel-chip{
  font-size:12px; font-weight:800; letter-spacing:.6px;
  padding:6px 10px; border-radius:8px;
  background:rgba(0,0,0,.35); color:#e8ecf6; border:1px solid rgba(255,255,255,.12);
}
[data-theme="light"] .rel-chip{ background:rgba(0,0,0,.08); color:#0f1320; border-color:rgba(0,0,0,.1); }

.rel-num{
  width:92px; height:36px; padding:6px 10px; border-radius:10px; outline:none;
  border:1px solid rgba(0,0,0,.12); background:rgba(255,255,255,.92); color:#0f1320;
  text-align:right; font-variant-numeric:tabular-nums;
}
[data-theme="dark"] .rel-num{ background:rgba(18,22,30,.92); color:#E9EEF7; border-color:rgba(255,255,255,.14); }
.rel-num:focus{ box-shadow:0 0 0 3px rgba(122,92,244,.24); border-color:#7A5CF4; }

/* stack spacing when arrows are between weights */
.rel-arrows{ display:flex; flex-direction:column; gap:8px; margin: 6px 0 10px; }

/* responsive floor so arrows don’t overflow on tiny screens */
@media (max-width: 520px){
  .rel-panel .rel-line{ flex-basis: 360px; min-width: 160px; }
}




:root{
  --dlg-max-inline: calc(100svw - var(--sidebar-w) - 32px);
}
/* ==== Project Action Menu (three-dot dropdown) ==== */
.hub-menu-wrap {
  position: relative;
  display: inline-block;
}

.hub-menu-btn {
  border: none;
  background: transparent;
  font-size: 1.2rem;
  cursor: pointer;
  line-height: 1;
  color: var(--text, #ccc);
  padding: 4px 8px;
  border-radius: 6px;
  transition: background 0.2s ease;
}
.hub-menu-btn:hover {
  background: rgba(255, 255, 255, 0.08);
}

.hub-menu {
  position: absolute;
  right: 0;
  top: 110%;
  background: var(--bg-alt, rgba(18, 22, 30, 0.96));
  border: 1px solid var(--border-color, rgba(255, 255, 255, 0.14));
  border-radius: 8px;
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  z-index: 999;
  min-width: 140px;
  animation: fadeIn 0.15s ease;
}
.hub-menu button {
  background: transparent;
  border: none;
  padding: 8px 12px;
  text-align: left;
  color: var(--text, #eee);
  cursor: pointer;
  font-size: 0.9rem;
  transition: background 0.2s ease;
}
.hub-menu button:hover {
  background: rgba(255, 255, 255, 0.08);
}
.hub-menu button.danger {
  color: #ff4b4b;
}
[data-theme="light"] .hub-menu {
  background: #fff;
  color: #111;
  border-color: rgba(0, 0, 0, 0.12);
}
[data-theme="light"] .hub-menu button:hover {
  background: rgba(0, 0, 0, 0.06);
}



/* ---------- shared vars (single source of truth) ---------- */
:root{
  --sidebar-w: 0px;
  --content-w: calc(100svw - var(--sidebar-w));
  --modal-shift-frac: 0.22;
  --modal-maxw: 560px;
  --modal-minw: 260px;
  --dlg-gutter-l: clamp(8px, 2vw, 18px);
  --dlg-gutter-r: clamp(18px, 3vw, 28px);
  --dlg-top-gap: clamp(12px, 2vh, 24px);
}

/* Center dialogs in the content area (viewport minus sidebar) */
:root{
  --dlg-margin: 24px;
  --content-center-left: calc(var(--sidebar-w) + ((100svw - var(--sidebar-w)) / 2));
  --dlg-max-inline: calc(100svw - var(--sidebar-w) - var(--dlg-margin));
}


/* ==== Danger Button Variant ==== */
.ws-btn.danger {
  color: #ff4b4b;
  border-color: rgba(255, 75, 75, 0.3);
}
.ws-btn.danger:hover {
  background: rgba(255, 75, 75, 0.08);
  border-color: rgba(255, 75, 75, 0.5);
}
[data-theme="dark"] .ws-btn.danger:hover {
  background: rgba(255, 75, 75, 0.15);
}

/* ---------- Top Toolbar ---------- */
.sc-top-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-top: 1rem;
  margin-bottom: 1rem;
  gap: 1rem;
  flex-wrap: wrap;
}

.sc-current.compact {
  background: var(--glass);
  border: 1px solid var(--glass-bdr);
  padding: 0.6rem 0.9rem;
  border-radius: 0.8rem;
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
  min-width: 280px;
  max-width: 460px;
}

.sc-cur-title {
  font-weight: 600;
  font-size: 0.95em;
}

.sc-cur-desc {
  font-size: 0.9em;
  opacity: 0.8;
  line-height: 1.3em;
}


/* z-layer authority */
.ws-backdrop-content,
.rel-backdrop{ z-index: 300 !important; }
.rel-center-over-content,
.ws-agent-view,
.rel-node-dialog,
.rel-panel{ z-index: 420 !important; }

/* modals shouldn't lift on hover like generic cards */
.ws-modal:hover{
  box-shadow: var(--shadow);
 transform: translate(-50%, -50%);   /* keep the centering on hover */
}


/* ---------- FLUID positioning over the content area ---------- */
/* Use this wrapper for BOTH the node details and the weight panel */

.rel-center-over-content{
  position: fixed;
  top: calc(env(safe-area-inset-top) + var(--dlg-top-gap));

  /* width math */
  --modal-width: clamp(
    var(--modal-minw),
    calc(var(--content-w) - (var(--dlg-gutter-l) + var(--dlg-gutter-r))),
    var(--modal-maxw)
  );
  --nudge: clamp(0px, calc(var(--content-w) * var(--modal-shift-frac)), 400px);

  left: calc(var(--sidebar-w) + ((var(--content-w) - var(--modal-width)) / 2) - var(--nudge));
  right: var(--dlg-gutter-r);
  width: var(--modal-width);
  transform: none;
}

/* Add/Edit modal uses rel-node centering — no right anchor */
.ws-center-over-content{
  position: fixed;
  left: var(--content-center-left, calc(var(--sidebar-w) + (100svw - var(--sidebar-w))/2));
  top: 50%;
  transform: translate(-50%, -50%);
  right: auto; /* important: never anchor by right */
  z-index: 600;
  /* Available inline width minus sidebar + gutters */
  --dlg-gutter-l: clamp(8px, 2vw, 18px);
  --dlg-gutter-r: clamp(32px, 6vw, 72px);
  --dlg-max-inline: calc(100svw - var(--sidebar-w) - var(--dlg-gutter-l) - var(--dlg-gutter-r));
  /* Fluid caps */
  --modal-maxw: clamp(480px, 56svw, 760px);
  width: min(clamp(260px, 64svw, var(--modal-maxw)), var(--dlg-max-inline));
  max-height: min(78svh, 580px);
  overflow: auto;
}

/* mid-range bump for gutter like rel */
@media (900px <= width <= 1280px){
  .ws-center-over-content{ --dlg-gutter-r: clamp(40px, 7vw, 84px); }
}

/* tiny phones: lower desktop cap */
@media (max-width: 420px){
  :root{ --modal-maxw: 480px; }
}

/* sticky action bar so buttons are always reachable */
.ws-modal-actions{
  position: sticky;
  bottom: 0;
  background: linear-gradient(to top, rgba(0,0,0,.28), transparent 16px);
}



/* === Backdrop that DOES NOT cover the sidebar === */
.ws-backdrop-content{
  position: fixed;
  inset: 0 0 0 var(--sidebar-w);
  z-index: 380;
}

html[data-theme="light"] .ws-backdrop-content,
body[data-theme="light"] .ws-backdrop-content,
.ws-backdrop-content[data-theme="light"]{
  background: rgba(6,10,20,.30) !important;
  backdrop-filter: blur(2px) saturate(115%) !important;
  -webkit-backdrop-filter: blur(2px) saturate(115%) !important;
}

/* Dark */
html[data-theme="dark"]  .ws-backdrop-content,
body[data-theme="dark"]  .ws-backdrop-content,
.ws-backdrop-content[data-theme="dark"]{
  background: rgba(6,10,20,.50) !important;
  backdrop-filter: blur(3px) saturate(120%) !important;
  -webkit-backdrop-filter: blur(3px) saturate(120%) !important;
}


/* Keep dialogs above the blur */
.rel-node-dialog,
.ws-agent-view,
.rel-center-over-content{ z-index: 420; }



/* ---------- Card sizing / contrast ---------- */
/* Both cards pick up width from the wrapper */
.ws-modal.ws-agent-view,
.rel-panel{
  width: 100%;
  max-width: none;
  min-width: var(--modal-minw);
  box-sizing: border-box;
  max-height: calc(100svh - var(--dlg-top-gap) - env(safe-area-inset-bottom) - 24px);
  overflow: auto;
  padding: clamp(12px, 1.8vw, 16px);
  border-radius: clamp(12px, 1.6vw, 16px);
  background: rgba(15,18,24,.96);
  color:#e9eef7;
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 22px 46px rgba(0,0,0,.35);
  font-size: clamp(13px, 1.6svw, 16px);
}

[data-theme="light"] .ws-modal.ws-agent-view,
[data-theme="light"] .rel-panel{
  background: rgba(255,255,255,.98);
  color:#0f1220;
  border-color: rgba(0,0,0,.12);
}
.ws-modal.ws-agent-view h3{ letter-spacing:.2px; }

/* (Optional) very small phones: lower the desktop cap a bit */
@media (max-width: 420px){
  :root{ --modal-maxw: 480px; }
}


/* Weight panel: add more right breathing room and trim max width */
.rel-panel.rel-center-over-content{
  /* push the right edge in a bit more */
  --dlg-gutter-r: clamp(32px, 6vw, 72px);   /* was ~22–34px */

  /* (optional) also trim its desktop cap so it’s a touch narrower overall */
  --modal-maxw: clamp(480px, 52svw, 760px);
}

/* If you want an extra bump only in the “middle” sizes */
@media (900px <= width <= 1280px){
  .rel-panel.rel-center-over-content{
    --dlg-gutter-r: clamp(40px, 7vw, 84px);
  }
}





/* ===== Relationships Graph ===== */
.rel-wrap{ position: relative; min-height: 560px; }

.rel-svg{
  display: block; width: 100%;
  background: radial-gradient(1200px 600px at 40% 40%, rgba(255,255,255,.04), transparent);
}

/* lines */
.rel-edge{
  stroke: #0e111a;
  stroke-width: 10;
}
[data-theme="dark"] .rel-edge{ stroke: rgba(255,255,255,.85); }

/* nodes */
.rel-node{
  fill: #181232;            /* deep purple dot from your wire */
  stroke: #0e111a;
  stroke-width: 2;
}
[data-theme="dark"] .rel-node{ stroke: rgba(255,255,255,.2); }

.rel-label{
  font-size: 14px;
  text-anchor: middle;
  fill: rgba(0,0,0,.7);
}
[data-theme="dark"] .rel-label{ fill: rgba(255,255,255,.85); }

/* node tooltip */
.rel-tip{
  position: fixed;          /* never clip on scroll containers */
  transform: translate(12px, -50%);
  max-width: 320px; padding: 12px 14px;
  border-radius: 14px; z-index: 200;
  background: rgba(16,20,28,.94);
  color: #e9eef7;
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 18px 40px rgba(0,0,0,.45);
  backdrop-filter: saturate(120%) blur(6px);
  line-height: 1.42;
}
[data-theme='light'] .rel-tip{
  background: rgba(255,255,255,.96);
  color:#0f1220; border-color: rgba(0,0,0,.12);
}

/* edge relationship panel */
.rel-panel{
  position: fixed;          /* place at line midpoint from JS */
  transform: translate(-50%, -50%);
  width: min(560px, 86vw);
  padding: 16px 18px;
  border-radius: 14px;
  background: rgba(210,210,210,.92);
  color: #12151d;
  border: 1px solid rgba(0,0,0,.12);
  box-shadow: 0 22px 46px rgba(0,0,0,.28);
  backdrop-filter: blur(6px);
  z-index: 220;
}
[data-theme="dark"] .rel-panel{
  background: rgba(24,26,34,.96);
  color:#e9eef7; border-color: rgba(255,255,255,.14);
}

.rel-panel-title{
  display:inline-block;
  font-weight: 800; letter-spacing:.5px;
  padding: 6px 10px; border-radius: 8px;
  background: #394252; color:#fff; margin-bottom: 10px;
}

.rel-arrows{
  display:flex; align-items:center; justify-content:space-between;
  gap: 12px; margin: 4px 0 10px;
}
.rel-arrows .rel-arrow{
  flex: 1 1 auto; height: 2px; position: relative; background: currentColor;
}
.rel-arrows .rel-arrow::before,
.rel-arrows .rel-arrow::after{
  content:""; position:absolute; top:50%; width: 8px; height: 8px;
  border-right: 2px solid currentColor; border-top: 2px solid currentColor;
  transform: translateY(-50%) rotate(45deg);
}
.rel-arrows .rel-arrow::before{ left: -2px; transform: translateY(-50%) rotate(-135deg); }
.rel-arrows .rel-arrow::after{ right: -2px; }

.rel-row{
  display:grid; grid-template-columns: 76px 1fr 52px; align-items:center;
  gap: 10px; margin: 6px 0;
}
.rel-row input[type="range"]{ width:100%; }
.rel-row output{ text-align:right; font-variant-numeric: tabular-nums; }

.rel-actions{
  position: sticky; bottom: 12px; display:flex; justify-content:flex-end; gap:10px; margin-top: 6px;
}

/* Labels */
.rel-label{ font-size: 14px; fill: rgba(255,255,255,.92); pointer-events:none; }
[data-theme='light'] .rel-label{ fill: rgba(15,18,32,.85); }
.rel-label.left{ text-shadow: 0 1px 2px rgba(0,0,0,.35); }
.rel-label.right{ text-shadow: 0 1px 2px rgba(0,0,0,.35); }

/* Emoji fallback inside node */
.rel-emoji{ font-size: 16px; dominant-baseline: middle; }

/* Edges (visible) */
.rel-edge{
  stroke: rgba(255,255,255,.85);
  stroke-width: 10;
  stroke-linecap: round;
}
[data-theme='light'] .rel-edge{ stroke: rgba(20,24,36,.82); }

/* Thick invisible hit-line for clicks */
.rel-edge-hit{
  stroke: transparent;
  stroke-width: 24;       /* big click target */
  cursor: pointer;
}

.rel-edge-pos { stroke: var(--accent-green, #4caf50); }
.rel-edge-neg { stroke: var(--accent-red, #e53935); }
.rel-edge-neu { stroke: var(--border-color, #aaa); }
.rel-edge:hover { stroke-width: 3; cursor: pointer; }
.rel-node, .rel-node-hit { cursor: pointer; }
.rel-node:hover { stroke: var(--accent, #66aaff); stroke-width: 3; }
.rel-edge-hit { cursor: pointer; opacity: 0; stroke-width: 15; }

.sc-bubble {
  white-space: pre-line;
}

/* Tooltip (same as before) */
/* .rel-tip { … } remains as you had */

/* Relationship panel */
.rel-panel{ position: fixed; transform: translate(-50%, -50%); z-index: 220; }
/* close button */
.rel-close{
  position: absolute; top: 8px; right: 8px;
  border: 1px solid rgba(255,255,255,.2);
  background: rgba(0,0,0,.25);
  color: #fff; border-radius: 8px; width: 28px; height: 28px;
}
[data-theme='light'] .rel-close{
  background: rgba(0,0,0,.06); color: #111; border-color: rgba(0,0,0,.12);
}

/* Make labels ignore pointer so clicks land on edges/nodes */
.rel-label { pointer-events: none; }

/* Slightly larger nodes already sized in JSX; this refines the ring */
.rel-node { stroke-width: 2; }

/* Click targets for edges (so it opens on click not hover) */
.rel-edge-hit{
  stroke: transparent;
  stroke-width: 24;     /* big click area */
  cursor: pointer;
}

/* Tooltip is positioned from JS; no change needed aside from z-index */
.rel-tip{ z-index: 200; }

/* Relationship panel center + close button */
.rel-panel{ z-index: 220; } 
.rel-close{
  position: absolute; top: 8px; right: 8px;
  width: 28px; height: 28px; border-radius: 8px;
}

/* Huge click/hover target for nodes (invisible) */
.rel-node-hit{
  fill: transparent;
  pointer-events: all;      /* capture hover/click */
  cursor: pointer;
}

/* Keep the visible node interactive too */
.rel-node{ cursor: pointer; }


/* ===== Nodes ===== */
.rel-node{
  fill: #181232;
  stroke: #0e111a; stroke-width: 2;
}
[data-theme='light'] .rel-node{
  fill: #ffffff;                   /* darker dot on light bg */
  stroke: rgba(0,0,0,.28);
}

/* Icon inside node (SVG uses currentColor) */
.rel-node-icon{ color: #cfe1ff; }  /* default for dark */
[data-theme='light'] .rel-node-icon{ color: #6b87ff; }

/* If you use image avatars, give them a subtle inner ring so they don't disappear */
.rel-node-img{
  rx: 18; ry: 18; /* clipPath already used; this is a no-op for most browsers */
}

/* ===== Labels ===== */
.rel-label{
  font-size: 14px;
  fill: rgba(233,238,247,.92);       /* dark theme text */
  pointer-events: none;
  paint-order: stroke;               /* draw stroke under fill */
  stroke: rgba(0,0,0,.25);
  stroke-width: 3px;                 /* subtle halo = readable on lines/stars */
}
[data-theme='light'] .rel-label{
  fill: rgba(15,18,32,.88);
  stroke: rgb(255, 255, 255);     /* light halo on light bg */
}

/* Keeps your left/right classes (shadow optional) */
.rel-label.left, .rel-label.right{ text-shadow: 0 1px 2px rgba(0,0,0,.25); }

/* ===== Tooltip/Panel z-index (unchanged, just ensuring) ===== */
.rel-tip{ z-index: 200; }
.rel-panel{ z-index: 220; }

/* ==== FINAL TOUCHES — append below ==== */

/* 1) Make the graph its own stacking context so tooltips/panels always win */
.rel-wrap { isolation: isolate; }

/* 2) Node hover/focus ring for better target feedback */
.rel-node:hover,
.rel-node:focus-visible {
  outline: 0;
  filter: drop-shadow(0 8px 22px rgba(162, 204, 200, 0.25));
}
[data-theme='light'] .rel-node:hover,
[data-theme='light'] .rel-node:focus-visible {
  filter: drop-shadow(0 8px 22px rgba(0,0,0,.18));
}

/* 3) Ensure icons/images pop in both themes */
.rel-node-icon { color: #cfe1ff; }
[data-theme='light'] .rel-node-icon { color: #6b87ff; }
.rel-node-img { /* subtle lift for image avatars */
  filter: drop-shadow(0 1px 0 rgba(0,0,0,.25));
}
[data-theme='light'] .rel-node-img {
  filter: drop-shadow(0 1px 0 rgb(255, 255, 255));
}

/* 4) Labels: keep halo strong and readable on busy backgrounds */
.rel-label {
  paint-order: stroke;
  stroke-width: 3px;
  text-shadow: 0 1px 2px rgba(0,0,0,.25);
}
[data-theme='light'] .rel-label {
  stroke: rgba(255,255,255,.65);
}

/* 5) Tooltip tweaks for tiny screens (prevents off-screen width) */
@media (max-width: 420px) {
  .rel-tip { max-width: 92vw; }
}

/* 6) Weight panel rows: wider left column so names don’t wrap */
.rel-row { grid-template-columns: 140px 1fr 52px; }

/* 7) Z-index sanity (tooltips under panel, both above everything) */
.rel-tip   { z-index: 200; }

/* 8) Click targets (confirm) — keep nodes easy to hit */
.rel-node-hit { pointer-events: all; cursor: pointer; }

.rel-tip { transform: translate(0,0); }

/* Backdrop shared by dialogs */
/* Leave the sidebar uncovered when graph dialogs are open */
.rel-backdrop{
  position: fixed;
  inset: 0 0 0 var(--sidebar-w);   /* <-- carve out the sidebar width */
  background: rgba(6,10,20,.55);
  backdrop-filter: blur(4px) saturate(120%);
}

/* lighter dim for light theme */
[data-theme="light"] .rel-backdrop{
  background: rgba(6,10,20,.35);
  backdrop-filter: blur(2px) saturate(115%);
}

/* keep darker in dark theme */
[data-theme="dark"] .rel-backdrop{
  background: rgba(6,10,20,.50);
  backdrop-filter: blur(3px) saturate(120%);
}


/* If you also have a generic backdrop used elsewhere, keep it full-screen */
.ws-modal-backdrop{
  position: fixed;
  inset: 0;
  background: rgba(6,10,20,.65);
  backdrop-filter: blur(4px) saturate(120%);
}

/* ---- z-index fix: dialogs above the blur ---- */
.rel-backdrop{ z-index: 300; }                  /* overlay that does the blurring */
.rel-center-over-content,
.rel-node-dialog,
.rel-panel,
.ws-modal.ws-agent-view{ z-index: 420; }       /* keep all dialogs on top */
.rel-svg text {
  paint-order: stroke;
  stroke: rgba(0,0,0,0.4);
  stroke-width: 3px;
}

.rel-chart {
  margin-top: 24px;
  background: var(--panel-bg, #1c1c1c);
  border-radius: 8px;
  padding: 12px 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  max-height: 220px;
  overflow-y: auto;
}

.rel-chart-title {
  font-size: 1rem;
  margin-bottom: 10px;
  color: var(--text-primary, #fff);
  font-weight: 600;
}

.rel-chart-table table {
  width: 100%;
  border-collapse: collapse;
  color: var(--text-secondary, #ddd);
}

.rel-chart-table th, .rel-chart-table td {
  padding: 6px 10px;
  text-align: left;
  font-size: 0.9rem;
}

.rel-chart-table th {
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.rel-chart-table tr:nth-child(even) {
  background: rgba(255,255,255,0.04);
}

.rel-chart-table td.pos {
  color: #3fb950; /* positive = green */
  font-weight: 600;
}

.rel-chart-table td.neg {
  color: #f85149; /* negative = red */
  font-weight: 600;
}

.rel-chart-table td.neu {
  color: #bbb; /* neutral = gray */
}



/* globals for safe spacing against the viewport + sidebar */


/* Centered node dialog — scales at every pixel */
.rel-node-dialog{
  position: fixed; inset: 50% auto auto 50%;
  transform: translate(-50%, -50%);
  /* Width rule: clamp first, then also cap by available inline space (viewport - sidebar - margin) */
  width: min( clamp(260px, 64svw, 560px), var(--dlg-max-inline) );
  max-width: var(--dlg-max-inline);

  /* Height scales too; scroll inside when needed */
  max-height: min(78svh, 580px);
  overflow: auto;

  /* Scalable paddings, radius, typography */
  padding: clamp(10px, 2svw, 18px);
  border-radius: clamp(10px, 1.2svw, 16px);
  font-size: clamp(13px, 1.6svw, 16px);
  line-height: 1.55;

  /* Never let content force dialog wider */
  box-sizing: border-box;
  overflow-wrap: anywhere;      /* breaks long tokens */
  word-break: break-word;
  hyphens: auto;

  /* Visuals */
  background: rgba(24,26,34,.96);
  color:#e9eef7;
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 22px 46px rgba(0,0,0,.28);

  /* Respect notches/safe areas on mobile */
  padding-left:  max(clamp(10px, 2svw, 18px), env(safe-area-inset-left));
  padding-right: max(clamp(10px, 2svw, 18px), env(safe-area-inset-right));
  margin-top:    env(safe-area-inset-top);
  margin-bottom: env(safe-area-inset-bottom);
}
[data-theme="light"] .rel-node-dialog{
  background: rgba(255,255,255,.96);
  color:#0f1220; border-color: rgba(0,0,0,.12);
}

/* Scalable header and close button */
.rel-node-title h3{ margin:0; font-weight:800; font-size: clamp(16px, 2svw, 20px); }
.rel-node-sub{ font-size: clamp(11px, 1.4svw, 12px); opacity:.85; }

.rel-close{
  position:absolute; top:8px; right:8px;
  width: clamp(28px, 3.2svw, 32px);
  height: clamp(28px, 3.2svw, 32px);
  border-radius: 8px;
  border:1px solid rgba(255,255,255,.20);
  background: rgba(0,0,0,.25);
  color:#fff;
}
[data-theme='light'] .rel-close{
  background: rgba(0,0,0,.06); color:#111; border-color: rgba(0,0,0,.12);
}

/* Make any media inside the dialog fluid */
.rel-node-dialog img,
.rel-node-dialog video,
.rel-node-dialog svg{ max-width: 100%; height: auto; display: block; }


/* Graph: stop shrinking below a readable width; allow horizontal scroll */
.rel-wrap{ position: relative; min-height: 560px; overflow:auto; }
.rel-svg{
  display:block;
  width: clamp(880px, 70svw, 1040px);
  aspect-ratio: 1040 / 620;
  margin-inline:auto;
}

/* Keep edge thickness constant while SVG scales */
.rel-edge, .rel-edge-hit{ vector-effect: non-scaling-stroke; }




.rel-center-over-content{
  position: fixed;
  left: var(--content-center-left);
  top: 50%;
}

/* Node detail dialog — fluid and capped by available space */


/* Weight panel — same responsive logic */
.rel-panel{
  width: min( clamp(300px, 70svw, 680px), var(--dlg-max-inline) );
  max-width: var(--dlg-max-inline);
  max-height: min(78svh, 620px);
  overflow:auto;
  padding: clamp(12px, 2svw, 20px);
  border-radius: clamp(10px, 1.2svw, 16px);
  box-sizing:border-box;

  background: rgba(24,26,34,.96);
  color:#e9eef7;
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 22px 46px rgba(0,0,0,.28);
}
[data-theme="light"] .rel-panel{
  background: rgba(255,255,255,.96);
  color:#0f1220; border-color: rgba(0,0,0,.12);
}

/* Dialog header & close */
.rel-node-head{ display:flex; align-items:center; gap:12px; margin-bottom:10px; }
.rel-node-avatar{ width:36px; height:36px; border-radius:10px; display:grid; place-items:center; background: rgba(255,255,255,.08); }
[data-theme='light'] .rel-node-avatar{ background: rgba(0,0,0,.06); }
.rel-node-title h3{ margin:0; font-weight:800; font-size: clamp(16px, 2svw, 20px); }
.rel-node-sub{ font-size: clamp(11px, 1.4svw, 12px); opacity:.85; }

.rel-close{
  position:absolute; top:8px; right:8px;
  width: clamp(28px, 3.2svw, 32px);
  height: clamp(28px, 3.2svw, 32px);
  border-radius: 8px;
  border:1px solid rgba(255,255,255,.20);
  background: rgba(0,0,0,.25);
  color:#fff;
}
[data-theme='light'] .rel-close{
  background: rgba(0,0,0,.06); color:#111; border-color: rgba(0,0,0,.12);
}





/* Scroll container: allow horizontal scroll + room for sticky buttons */
.rel-wrap{
  position: relative;
  min-height: 560px;
  overflow: auto;
  scrollbar-gutter: stable both-edges;
}

/* nicer horizontal scrollbar (keep your theme colors if you like) */
.rel-wrap::-webkit-scrollbar{ height: 10px; }
.rel-wrap::-webkit-scrollbar-track{ background: transparent; }
.rel-wrap::-webkit-scrollbar-thumb{
  background: linear-gradient(90deg, rgba(255,255,255,.18), rgba(255,255,255,.28));
  border-radius: 999px;
}
[data-theme="light"] .rel-wrap::-webkit-scrollbar-thumb{
  background: linear-gradient(90deg, rgba(0,0,0,.18), rgba(0,0,0,.28));
}
.rel-wrap{ scrollbar-width: thin; }
[data-theme="dark"]  .rel-wrap{ scrollbar-color: rgba(255,255,255,.28) transparent; }
[data-theme="light"] .rel-wrap{ scrollbar-color: rgba(0,0,0,.28) transparent; }

/* subtle bottom fade so the bar feels integrated */
.rel-wrap::after{
  content:"";
  position: sticky;
  bottom: 0;
  display:block;
  height: 24px;
  margin-top: -24px;
  pointer-events:none;
  z-index: 15;
}


/* ---- Sticky actions (follow BOTH axes of .rel-wrap) ----
   Pins the buttons to the RIGHT EDGE of the .rel-wrap scrollport.
*/
/* .rel-affix{
  position: sticky;
  bottom: 12px;                          
  margin-left: 90%;                           
  width: max-content;
  z-index: 240;
  pointer-events: none;                  
}

.rel-affix-inner{
  display:flex; gap:10px;
  padding: 6px 8px;
  border-radius: 14px;
  backdrop-filter: blur(6px);
  pointer-events: auto;                 
} */

/* === Affix buttons anchored to the viewport’s right/bottom === */
.rel-affix{
  position: fixed;
  right: max(env(safe-area-inset-right), 16px);
  bottom: max(env(safe-area-inset-bottom), 16px);
  left: auto;               /* ensure no left constraint */
  margin: 0;                /* kill the 90% trick */
  width: max-content;
  z-index: 420;             /* above blur overlays */
  pointer-events: none;     /* outer wrapper ignores clicks */
  transform: translateZ(0); /* new stacking context, avoids wobble */
}
.rel-affix-inner{
  display: flex; gap: 10px;
  padding: 6px 8px;
  border-radius: 14px;
  backdrop-filter: blur(6px);
  pointer-events: auto;     /* buttons clickable */
}


/* Graph canvas: readable floor, then center; horizontal scroll appears in .rel-wrap */
.rel-svg{
  display:block;
  width: clamp(880px, 70svw, 1040px);
  aspect-ratio: 1040 / 620;
  margin-inline:auto;
}

/* keep edge thickness constant */
.rel-edge, .rel-edge-hit{ vector-effect: non-scaling-stroke; }






/* ==== Relation table — COLORS ONLY (light & dark) ==== */
.rel-chart{
  /* container colors */
  --rel-bg: rgba(18,22,30,.96);
  --rel-ink: #E9EEF7;
  --rel-sub: #C9D0DE;
  --rel-border: rgba(255,255,255,.12);

  /* header */
  --rel-head-bg: linear-gradient(180deg, rgba(30,36,52,.92), rgba(22,26,38,.88));
  --rel-head-ink: #E9EEF7;

  /* rows */
  --rel-row-alt: rgba(255,255,255,.04);
  --rel-row-hover: rgba(122,92,244,.16);

  /* badges (Strength classes you already use) */
  --rel-pos-bg: rgba(46,201,122,.22);
  --rel-pos-ink:#7df6b7;
  --rel-neg-bg: rgba(244,67,54,.22);
  --rel-neg-ink:#ff8a80;
  --rel-neu-bg: rgba(140,150,170,.22);
  --rel-neu-ink:#c9d0de;

  background: var(--rel-bg);
  border-color: var(--rel-border);
  color: var(--rel-ink);
}

/* Light theme tokens */
[data-theme="light"] .rel-chart{
  --rel-bg: rgba(255,255,255,.98);
  --rel-ink: #0f1220;
  --rel-sub: #4d5566;
  --rel-border: rgba(0,0,0,.12);

  --rel-head-bg: linear-gradient(180deg, #fafafa, #f3f3f3);
  --rel-head-ink: #0f1220;

  --rel-row-alt: rgba(0,0,0,.035);
  --rel-row-hover: rgba(120,110,220,.10);

  --rel-pos-bg: rgba(46,201,122,.16);
  --rel-pos-ink:#1b8a56;
  --rel-neg-bg: rgba(244,67,54,.14);
  --rel-neg-ink:#b7221b;
  --rel-neu-bg: rgba(120,130,150,.12);
  --rel-neu-ink:#4d5566;
}

/* title + container border color only */
.rel-chart-title{
  color: var(--rel-ink);
  border-bottom: 1px solid var(--rel-border);
}

/* table text/borders — colors only */
.rel-chart-table table{ color: var(--rel-ink); }
.rel-chart-table th{
  background: var(--rel-head-bg);
  color: var(--rel-head-ink);
  border-bottom: 1px solid var(--rel-border);
}
.rel-chart-table td{
  border-bottom: 1px solid var(--rel-border);
  color: var(--rel-ink);
}

/* zebra + hover (colors only) */
.rel-chart-table tbody tr:nth-child(odd){ background: var(--rel-row-alt); }
.rel-chart-table tbody tr:hover{ background: var(--rel-row-hover); }

/* Keep row background continuous in Strength column */
.rel-chart-table td.pos,
.rel-chart-table td.neg,
.rel-chart-table td.neu{
  background: transparent !important; /* don't fill the whole cell */
  border-radius: 0 !important;        /* remove pill rounding on the cell */
  /* keep whatever text colors you already set */
}

/* --- Make zebra/hover span ALL columns uniformly --- */
.rel-chart-table tbody tr:nth-child(odd) > th,
.rel-chart-table tbody tr:nth-child(odd) > td {
  background: var(--rel-row-alt) !important;
}
.rel-chart-table tbody tr:hover > th,
.rel-chart-table tbody tr:hover > td {
  background: var(--rel-row-hover) !important;
}

/* --- Reset any per-cell backgrounds that block the row color --- */
.rel-chart-table th,
.rel-chart-table td {
  background: transparent !important;   /* let the row color show through */
}

/* Strength cells must NEVER paint their own bg (no pills) */
.rel-chart-table td.pos,
.rel-chart-table td.neg,
.rel-chart-table td.neu {
  background: transparent !important;
  border-radius: 0 !important;
}








/* Make the sidebar "View" modal use centered math (no lateral nudge) */
.ws-agent-view.rel-center-over-content{
  --modal-shift-frac: 0;   /* overrides the global 0.22 */
}

/* Modals should not "lift" on hover like cards */
.ws-modal:hover{ transform: none; box-shadow: var(--shadow); }

/* Ensure z-order matches rel dialogs */
.ws-backdrop-content{ z-index: 300; }
.ws-agent-view.rel-center-over-content{ z-index: 420; }









/* before (example) */
[data-theme='dark'] .sc-canvas { background: var(--space-gradient); }

/* after */
.sc-canvas { background: var(--space-gradient); }

/* keep borders/ink color theme-specific if you want */
[data-theme='dark'] .sc-canvas { border-color: rgba(255,255,255,.10); }
[data-theme='light'] .sc-canvas { border-color: rgba(0,0,0,.08); }




/* ---------- Global (once) ---------- */
html, body { height: 100%; overflow-x: hidden; }
.app.ws-page { min-height: 100svh; }

/* ---------- Scenario page shell ---------- */
.sc-page{ display:flex; flex-direction:column; gap:12px; }
.sc-page {
  position: relative;
}
.sc-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.45);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}


.sc-spinner.big {
  width: 60px;
  height: 60px;
  border: 6px solid #fff;
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 0.9s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* ---- Pretty nav ---- */
.sc-nav{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 12px; }
.sc-nav-pretty{
  backdrop-filter: saturate(120%) blur(8px);
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 16px;
}
[data-theme="light"] .sc-nav-pretty{
  background: linear-gradient(180deg, rgba(0,0,0,.04), rgba(0,0,0,.02));
  border-color: rgba(0,0,0,.1);
}
.sc-brand{ display:flex; align-items:center; gap:12px; }
.sc-brand .logo{ width:34px; height:34px; border-radius:8px; display:grid; place-items:center; font-weight:900; letter-spacing:.2px; }
.sc-divider{ width:1px; height:24px; background: currentColor; opacity:.16; border-radius:1px; }
.sc-tabs{ display:flex; gap:8px; }
.sc-tab{
  padding:8px 12px; border-radius:10px; font-weight:700; letter-spacing:.2px;
  background: rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.12);
}
.sc-tab.ghost{ background: transparent; }
[data-theme="light"] .sc-tab{ background: rgba(0,0,0,.05); border-color: rgba(0,0,0,.1); }

/* ---------- Scenario input ---------- */
.sc-input .sc-input-row{
  display:grid; grid-template-columns: 84px 1fr auto; gap:10px; align-items:center;
}
.sc-input textarea{
  resize:none; height:38px; padding:8px 10px; border-radius:10px;
  border:1px solid rgba(0,0,0,.12); background:rgba(255,255,255,.92); color:#0f1220;
}
[data-theme='dark'] .sc-input textarea{ background:rgba(17,22,30,.92); color:#E9EEF7; border-color:rgba(255,255,255,.14); }

/* ---------- Grid (row1: canvas+log, row2: roster across) ---------- */
.sc-main{
  display:grid;
  grid-template-columns: 1fr minmax(300px, 360px);
  grid-template-rows: auto auto;
  grid-template-areas:
    "canvas log"
    "roster roster";    /* ← log no longer spans; roster owns row 2 */
  gap:12px;
  margin-bottom:12px;
}
@media (max-width: 920px){
  .sc-main{
    grid-template-columns: 1fr;
    grid-template-rows: auto auto auto;
    grid-template-areas:
      "canvas"
      "log"
      "roster";
  }
}
.sc-canvas{ grid-area: canvas; }
.sc-log{ grid-area: log; display:flex; flex-direction:column; }

/* ---------- Canvas pre/post heights (edit these values) ---------- */
.sc-canvas{
  --pre-h:  clamp(500px, 66vh, 880px); /* BEFORE Generate (taller) */
  --post-h: clamp(500px, 52vh, 680px); /* AFTER  Generate  (shorter) */
  position: relative;
  overflow: hidden; /* clip nodes/bubbles to the canvas */
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  border: 1px solid rgba(0,0,0,.06);
}
[data-theme='dark'] .sc-canvas{ border-color: rgba(255,255,255,.10); }
.sc-canvas.pre  { min-height: var(--pre-h); }
.sc-canvas.post { min-height: var(--post-h); }

.sc-center{ position:absolute; inset:0; display:grid; place-items:center; }
.sc-spinner, .sc-spinner.big{
  width:26px; height:26px; border-radius:999px; border:3px solid rgba(0,0,0,.18);
  border-top-color:transparent; animation: sc-spin .8s linear infinite;
}
.sc-spinner.big{ width:64px; height:64px; border-width:5px; }
@keyframes sc-spin{ to{ transform: rotate(360deg); } }
[data-theme='dark'] .sc-spinner{ border-color: rgba(255,255,255,.22); }

/* ---------- Nodes ---------- */
.sc-node{ position:absolute; transform:translate(-50%,-50%); display:flex; align-items:center; gap:8px; user-select:none; transition:left .6s ease, top .6s ease; }
.sc-node.is-active .sc-chip{
  box-shadow: 0 0 0 2px rgba(88,122,255,.25), 0 10px 24px rgba(70,110,255,.35);
}
.sc-node .sc-chip{
  width:28px; height:28px; border-radius:999px; display:grid; place-items:center;
  background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.65));
  border: 1px solid rgba(0,0,0,.06); box-shadow: 0 6px 18px rgba(0,0,0,.12);
}
[data-theme='dark'] .sc-node .sc-chip{
  background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.08));
  border-color: rgba(255,255,255,.14);
}
.sc-node .sc-name{ font-weight:700; text-shadow: 0 1px 2px rgba(0,0,0,.25); }
.sc-node-bubble{
  position:absolute;
  transform: translate(-50%, -110%);
  max-width: 280px;
  padding: 12px 14px;
  border-radius: 14px;
  background: rgba(255,255,255,.95);
  color:#101520;
  border: 1px solid rgba(0,0,0,.08);
  box-shadow: 0 18px 44px rgba(0,0,0,.22);
  pointer-events: none;
  z-index:3;
  font-size: .85rem;
  line-height: 1.35;
  text-align: center;
  transition: opacity .35s ease, transform .4s ease;
}
.sc-node-bubble p{ margin:0; font-weight:600; }
.sc-node-bubble .turn{
  display:block;
  margin-top:6px;
  font-size:.7rem;
  letter-spacing:.04em;
  text-transform: uppercase;
  opacity:.65;
  font-weight:600;
}
.sc-node-bubble.is-active{
  border-color: rgba(88,122,255,.65);
  box-shadow: 0 22px 48px rgba(72,124,255,.36);
}
[data-theme='dark'] .sc-node-bubble{
  background: rgba(16,20,28,.92);
  color:#F1F6FF;
  border-color: rgba(255,255,255,.12);
  box-shadow: 0 22px 52px rgba(0,0,0,.48);
}
[data-theme='dark'] .sc-node-bubble.is-active{
  border-color: rgba(120,160,255,.75);
  box-shadow: 0 24px 60px rgba(90,135,255,.42);
}

/* ---------- Bubble (visual only; transform is inline from JS) ---------- */
.sc-bubble{
  position: absolute;
  transform: translate(-50%, -110%);
  max-width: 320px; padding: 10px 12px;
  border-radius: 12px;
  background: rgba(16,20,28,.94); color:#E9EEF7;
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 16px 40px rgba(0,0,0,.45);
  pointer-events: none; z-index: 2;
}
[data-theme='light'] .sc-bubble{ background:#fff; color:#0f1220; border-color: rgba(0,0,0,.12); }

/* ---------- Log (compact height + pretty scrollbar) ---------- */
.sc-log.compact{
  align-self: start;
  --log-h: clamp(500px, 34vh, 420px);
  height: var(--log-h);
  min-height: 0 !important;
}
.sc-log-head{ font-weight:900; letter-spacing:.3px; margin-bottom:8px; }
.sc-log-list{
  overflow: auto;
  max-height: calc(var(--log-h) - 40px);
  display:flex; flex-direction:column; gap:12px;
  padding-right: 6px;
  scrollbar-width: thin;
  scrollbar-color: rgba(140,150,170,.6) transparent;
}
.sc-log-item .who{ display:flex; align-items:center; gap:8px; opacity:.9; }
.sc-log-item .who .dot{ width:8px; height:8px; border-radius:999px; background:#ff5d5d; display:inline-block; }
.sc-log-item .who .turn{ margin-left:auto; font-size:12px; opacity:.7; }
.sc-log-item p{ margin:6px 0 0; line-height:1.45; }
.sc-log-list::-webkit-scrollbar{ width: 10px; }
.sc-log-list::-webkit-scrollbar-track{ background: transparent; }
.sc-log-list::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, rgba(140,150,170,.65), rgba(120,110,220,.55));
  border-radius: 10px; border: 2px solid transparent; background-clip: padding-box;
}

/* ---------- Roster: 5 per row on wide screens, then 4/3/2/1 ---------- */
.sc-roster{
  margin-top: 2px;
  grid-area: roster;
  display:grid;
  gap:12px;
  align-items:stretch;
  grid-template-columns: repeat(5, minmax(200px, 1fr));
}
@media (max-width:1400px){ .sc-roster{ grid-template-columns: repeat(4, minmax(200px,1fr)); } }
@media (max-width:1200px){ .sc-roster{ grid-template-columns: repeat(3, minmax(200px,1fr)); } }
@media (max-width:920px) { .sc-roster{ grid-template-columns: repeat(2, minmax(200px,1fr)); } }
@media (max-width:620px) { .sc-roster{ grid-template-columns: 1fr; } }

/* Equal-height stretcher */
.sc-roster .agent-card-wrap{ display:flex; min-height: 0; }
.sc-roster .agent-card-wrap > *{
  flex:1 1 auto;
  min-height: clamp(460px, 48vh, 520px);
  display:flex; flex-direction:column;
}

/* If your AgentCard uses ws-card root, stretch inner content */
.sc-roster .ws-card{ height:100%; display:flex; flex-direction:column; }
.sc-roster .ws-card .ws-card-body{ flex:1; display:flex; flex-direction:column; }

/* Hide edit/close in scenario roster only */
.sc-roster .agent-card .ws-icon-btn,
.sc-roster .agent-card [aria-label="Edit"],
.sc-roster .agent-card [aria-label="Remove"],
.sc-roster .agent-card .card-actions,
.sc-roster .agent-card [aria-label="Close"],
.sc-roster .agent-card .ws-card-actions,
.sc-roster .ws-card .ws-icon-btn[aria-label],
.sc-roster .ws-card [aria-label="Edit"],
.sc-roster .ws-card [aria-label="Remove"],
.sc-roster .ws-card [aria-label="Close"]{
  display:none !important;
}


/* ---------- Nav right: theme + user ---------- */
.sc-right{ display:flex; align-items:center; gap:14px; }
.sc-user{
  display:flex; align-items:center; gap:10px; padding:6px 8px;
  border-radius:12px; background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12); cursor:pointer;
}
[data-theme="light"] .sc-user{ background:rgba(0,0,0,.06); border-color:rgba(0,0,0,.12); }
.sc-user .avatar{
  width:32px; height:32px; border-radius:50%;
  display:grid; place-items:center; font-weight:800;
  background:linear-gradient(135deg,#7A5CF4,#30D7E9); color:#fff;
}
.sc-user .meta{ line-height:1.1 }
.sc-user .name{ font-weight:700; font-size:13px; opacity:.95 }
.sc-user .role{ font-size:11px; opacity:.7 }

/* ---------- Hide edit/close *only* inside scenario roster ---------- */
.sc-roster .agent-card .ws-icon-btn,
.sc-roster .agent-card [aria-label="Edit"],
.sc-roster .agent-card [aria-label="Remove"],
.sc-roster .agent-card .card-actions,
.sc-roster .agent-card [aria-label="Close"],
.sc-roster .agent-card .ws-card-actions{ display: none !important; }
.sc-roster .ws-card .ws-icon-btn[aria-label],
.sc-roster .ws-card [aria-label="Edit"],
.sc-roster .ws-card [aria-label="Remove"],
.sc-roster .ws-card [aria-label="Close"]{ display: none !important; }
/* Scenario page: hide the round emoji/glyph at the far-left of each AgentCard header */
.sc-roster .ws-card .card-head .ws-circle,
.sc-roster .ws-card .card-head .agent-avatar,
.sc-roster .ws-card .card-head .avatar,
.sc-roster .ws-card .card-head .icon-badge,
.sc-roster .ws-card .card-head [class*="icon"],
/* last resort: if the icon is just the first SVG in the header */
.sc-roster .ws-card .card-head svg:first-of-type {
  display: none !important;
}


/* ---------- Roster: equal card heights ---------- */
.sc-roster{ margin-top: 2px; align-items:stretch; }
.sc-roster .agent-card-wrap{ display:flex; min-height: 0; }
.sc-roster .agent-card-wrap > *{
  flex:1 1 auto;                       /* AgentCard fills cell */
  min-height: clamp(460px, 48vh, 520px); /* uniform, responsive */
  display:flex; flex-direction:column;
}
.sc-roster .ws-card{ height:100%; display:flex; flex-direction:column; }
.sc-roster .ws-card .ws-card-body{ flex:1; display:flex; flex-direction:column; }

/* ---------- FINAL AUTHORITY height overrides (wins even if older rules linger) ---------- */
.sc-canvas.pre,
.sc-main .sc-canvas.pre{
  height: var(--pre-h) !important;
  min-height: var(--pre-h) !important;
}
.sc-canvas.post,
.sc-main .sc-canvas.post{
  height: var(--post-h) !important;
  min-height: var(--post-h) !important;
}

/* Ensure compact log always uses its own height */
.sc-log.compact{
  height: var(--log-h) !important;
  min-height: 0 !important;
}





/* (Already hidden in your sheet, but keep this here to be safe in Scenario) */
.sc-roster .ws-card.agent .ws-agent-head .ws-icon-btn {
  display: none !important;
}

/* ===================================== */
/* Agent card layout & compact previews  */
/* ===================================== */

.ws-card.agent {
  max-width: 420px;              /* keeps cards from stretching */
  word-wrap: break-word;
  overflow-wrap: anywhere;
  white-space: normal;
  line-height: 1.45;
  padding: 14px 18px;
}

/* Tighter key–value layout */
.ws-card.agent .ws-kv {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.ws-card.agent .ws-k {
  font-weight: 600;
  font-size: 0.85rem;
  opacity: 0.8;
}

.ws-card.agent .ws-v {
  font-size: 0.9rem;
  color: var(--text-secondary, #000000);
  overflow: hidden;              /* just in case very long words sneak in */
  text-overflow: ellipsis;
}

/* On hover, allow full wrap (if you ever remove the 24-char trim later) */
.ws-card.agent:hover .ws-v {
  overflow: visible;
  white-space: normal;
}



/* === Tooltip alignment fix for smaller screens === */
@media (max-width: 720px) {
  .ws-card.agent .tooltip-text {
    left: 50% !important;             /* center horizontally */
    transform: translateX(-50%) !important;
    min-width: max(160px, 60%);       /* prevent too-narrow boxes */
    white-space: normal;              /* allow wrapping */
    text-align: center;
  }

  /* optional: slightly smaller tooltip padding and font for compact view */
  .ws-card.agent .tooltip-text {
    font-size: 0.85rem;
    padding: 6px 8px;
  }

  /* prevent tooltip from overflowing vertically */
  .ws-card.agent {
    overflow: visible;
  }
}

/* === Dark mode fix for agent data text === */

[data-theme="dark"] .ws-card.agent .ws-v {
  color: #EAEAF1;                     /* white-ish data text */
}




/* ===================================== */
/* Tooltip popups for ws-v fields        */
/* ===================================== */
.tooltip {
  position: relative;
  cursor: pointer;                     /* indicates hover info */
  display: inline-block;
}

.tooltip .tooltip-text {
  visibility: hidden;
  opacity: 0;
  position: absolute;
  left: 50%;
                  /* position above the text */
  transform: translateX(-50%);
  z-index: 999;
  min-width: 220px;
  max-width: 320px;
  background: rgba(30, 30, 40, 0.95);
  color: #fff;
  text-align: left;
  padding: 8px 10px;
  border-radius: 8px;
  font-size: 0.85rem;
  line-height: 1.35;
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.3);
  transition: opacity 0.2s ease;
  pointer-events: none;
  white-space: normal;              /* allows multi-line */
}

[data-theme="light"] .tooltip .tooltip-text {
  background: rgba(250, 250, 250, 0.97);
  color: #222;
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.15);
}

.tooltip:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}


.tooltip .tooltip-text {
  bottom: calc(100% + 8px); /* instead of bottom:120%; */
}

/* ========= Scenario "Threads" Grid (theme-aware) ========= */
/* Enables with .sc-grid on .sc-canvas */
.sc-canvas.sc-grid{
  position: relative;
  overflow: hidden;            /* keep the grid inside rounded card */
  background: transparent;     /* we’ll paint the background with layers below */
  isolation: isolate;          /* so blend modes don’t leak out */
}

/* Base: a soft vignette + subtle backdrop to keep nodes readable */
.sc-canvas.sc-grid::backdrop,
.sc-canvas.sc-grid::before,
.sc-canvas.sc-grid::after{ content:""; }

/* Layer 1: scene glow / vignette */
.sc-canvas.sc-grid::before{
  position: absolute; inset: -2% -2%;
  z-index: 0;
  /* theme base: soft gradient wash */
  background:
    radial-gradient(120% 100% at 50% 110%, var(--sc-bg-deep) 0%, transparent 60%) ,
    radial-gradient(100% 140% at 50% -20%, var(--sc-bg-top) 0%, transparent 70%);
  pointer-events: none;
}

/* Layer 2: perspective grid lines (crisp strokes) */
.sc-canvas.sc-grid::after{
  position: absolute;
  left: -10%; right: -10%;
  top: -10%; bottom: -35%;
  z-index: 0;
  /* two repeating gradient layers: vertical and horizontal lines */
  background:
    repeating-linear-gradient(to right,
      var(--sc-grid-stroke) 0 2px, transparent 2px 40px),
    repeating-linear-gradient(to bottom,
      var(--sc-grid-stroke) 0 2px, transparent 2px 40px);
  transform-origin: 50% 15%;
  filter: drop-shadow(0 0 6px var(--sc-grid-glow));
  mix-blend-mode: screen;      /* makes the neon pop in dark; gentle in light */
  opacity: var(--sc-grid-opacity, .68);
  pointer-events: none;
  border-radius: inherit;
}

/* Optional: subtle “mist” over far horizon for depth (keeps text readable) */
.sc-canvas.sc-grid ,
.sc-canvas.sc-grid ,
.sc-canvas.sc-grid {
  position: relative;
  z-index: 1;   /* always above the grid layers */
}

/* ---- Theme variables ---- */
:root, [data-theme="light"]{
  /* Light mode neon (pink/magenta) */
  --sc-grid-stroke: rgba(248, 64, 120, .45);
  --sc-grid-glow:   rgba(248, 64, 120, .55);
  --sc-grid-opacity: .60;

  /* background wash for light */
  --sc-bg-top:  rgba(90, 120, 255, .10);
  --sc-bg-deep: rgba(0, 0, 0, .06);
}

[data-theme="dark"]{
  /* Dark mode neon (cyan/blue) */
  --sc-grid-stroke: rgba(90, 180, 255, .35);
  --sc-grid-glow:   rgba(90, 180, 255, .55);
  --sc-grid-opacity: .72;

  /* background wash for dark */
  --sc-bg-top:  rgba(90, 70, 220, .22);
  --sc-bg-deep: rgba(0, 0, 0, .28);
}

/* Optional polish: make chips pop a bit more on the grid */
.sc-canvas.sc-grid .sc-chip{
  box-shadow:
    0 8px 24px rgba(0,0,0,.18),
    0 0 0 1px rgba(255,255,255,.06) inset;
}

/* Keep bubbles readable atop bright lines */
.sc-canvas.sc-grid .sc-bubble{
  backdrop-filter: saturate(120%) blur(6px);
  background: color-mix(in srgb, var(--sc-bubble-bg, #10141c) 92%, transparent);
}
[data-theme="light"] .sc-canvas.sc-grid .sc-bubble{
  --sc-bubble-bg: #ffffff;
}
[data-theme="dark"] .sc-canvas.sc-grid .sc-bubble{
  --sc-bubble-bg: #10141c;
}


/* ==== Scenario Nav – DARK MODE ==== */
[data-theme="dark"] .sc-nav-pretty{
  /* glassy panel */
  background: linear-gradient(180deg, rgba(10,14,22,.72), rgba(10,14,22,.58));
  border: 1px solid rgba(255,255,255,.10);
  box-shadow:
    0 6px 22px rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.05);
  color: #E9EEF7;
}

[data-theme="dark"] .sc-brand .logo{
  color:#E9EEF7;
  background: linear-gradient(180deg, rgba(255,255,255,.1), rgba(255,255,255,.06));
  border: 1px solid rgba(255,255,255,.12);
}

[data-theme="dark"] .sc-divider{
  background: #E9EEF7;
  opacity:.18;
}

/* Tabs */
[data-theme="dark"] .sc-tab{
  color:#E9EEF7;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
  backdrop-filter: saturate(120%) blur(6px);
  transition: background .15s ease, border-color .15s ease, box-shadow .15s ease;
}
[data-theme="dark"] .sc-tab:hover{
  background: rgba(255,255,255,.10);
  border-color: rgba(255,255,255,.16);
  box-shadow: 0 4px 14px rgba(0,0,0,.35);
}
[data-theme="dark"] .sc-tab:focus-visible{
  outline:none;
  box-shadow: 0 0 0 3px rgba(122,92,244,.35);
}

/* “ghost” tab (secondary) */
[data-theme="dark"] .sc-tab.ghost{
  background: transparent;
  border-color: rgba(255,255,255,.10);
}
[data-theme="dark"] .sc-tab.ghost:hover{
  background: rgba(255,255,255,.06);
}

/* active/current tab */
.sc-tab.is-active,
.sc-tab[aria-current="page"]{
  box-shadow: inset 0 0 0 1px rgba(122,92,244,.55), 0 6px 16px rgba(0,0,0,.28);
}
[data-theme="dark"] .sc-tab.is-active,
[data-theme="dark"] .sc-tab[aria-current="page"]{
  background: linear-gradient(180deg, rgba(122,92,244,.20), rgba(122,92,244,.10));
  border-color: rgba(122,92,244,.55);
}

/* ===== Animated Pretty Nav (light + dark) ===== */
.sc-nav-pretty{
  /* shared */
  position: relative;
  border-radius: 16px;
  border: 1px solid var(--nav-border, rgba(255,255,255,.12));
  overflow: hidden;                 /* clip animated layer to rounded corners */
  isolation: isolate;               /* ensure ::before sits under children */
}

/* The moving gradient film */
.sc-nav-pretty::before{
  content:"";
  position:absolute; inset:0;
  z-index: -1;
  border-radius: inherit;

  /* default (dark) film */
  --film: radial-gradient(1200px 600px at -20% -40%, rgba(122,92,244,.18), transparent 60%),
           radial-gradient(1000px 600px at 120% 140%, rgba(48,215,233,.16), transparent 55%),
           linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
  background: var(--film);
  background-size: 200% 200%, 200% 200%, 100% 100%;
  animation: scNavSweep 12s ease-in-out infinite alternate;
}

/* Base tokens: dark */
.sc-nav-pretty{
  --nav-border: rgba(255,255,255,.12);
}
.sc-tab{
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.12);
  transition: transform .2s ease, background .25s ease, border-color .25s ease, box-shadow .25s ease;
}
.sc-tab:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,.12);
  border-color: rgba(255,255,255,.18);
  box-shadow: 0 8px 24px rgba(0,0,0,.22);
}

/* Light mode variant: softer glass + colored sweep */
[data-theme="light"] .sc-nav-pretty{
  --nav-border: rgba(0,0,0,.12);
}
[data-theme="light"] .sc-nav-pretty::before{
  /* swap the film for light */
  --film: radial-gradient(1200px 600px at -15% -30%, rgba(122,92,244,.15), transparent 60%),
          radial-gradient(1000px 600px at 115% 135%, rgba(48,215,233,.14), transparent 55%),
          linear-gradient(180deg, rgba(0,0,0,.04), rgba(0,0,0,.02));
  background: var(--film);
  background-size: 200% 200%, 200% 200%, 100% 100%;
}

/* Tabs in light mode */
[data-theme="light"] .sc-tab{
  background: rgba(0,0,0,.05);
  border-color: rgba(0,0,0,.10);
}
[data-theme="light"] .sc-tab:hover{
  background: rgba(0,0,0,.08);
  border-color: rgba(0,0,0,.16);
  box-shadow: 0 10px 26px rgba(24,38,64,.14);
}

@keyframes scNavSweep{
  0%   { background-position: 0% 40%, 100% 60%, 0% 0%; }
  50%  { background-position: 50% 60%, 50% 40%, 0% 0%; }
  100% { background-position: 100% 40%, 0% 60%, 0% 0%; }
}

/* Respect motion preferences */
@media (prefers-reduced-motion: reduce){
  .sc-nav-pretty::before{ animation: none; }
}

/* --- Workstation Hub --- */
.hub-page {
  display: flex;
 
  min-height: 100vh;
  background: var(--bg);
  color: var(--text);
}

.hub-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 20px;
  border-bottom: 1px solid var(--border);
}

.hub-main {
  flex: 1;
  padding: 2rem;
  max-width: 900px;
  margin: 0 auto;
}

.hub-intro {
  margin-bottom: 1.8rem;
  text-align: center;
}

.hub-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 1rem;
}

.hub-card {
  padding: 1.2rem 1.4rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-height: 160px;
}

.hub-card-head h3 {
  margin: 0;
}

.hub-meta {
  font-size: 0.85rem;
  opacity: 0.75;
  margin-top: 0.3rem;
}

.hub-desc {
  flex: 1;
  margin: 0.8rem 0;
}

.hub-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.6rem;
}

.hub-new {
  text-align: center;
  margin-top: 2rem;
}

/* ==== Hub Enhancements ==== */
.hub-title-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.hub-chip {
  border-radius: 8px;
  padding: 2px 8px;
  font-size: 0.75rem;
  text-transform: uppercase;
  font-weight: 600;
}

.hub-chip.active {
  background: #c0ffc0;
  color: #054a05;
}
.hub-chip.inactive {
  background: #ffe0b3;
  color: #664400;
}
.hub-chip.archived {
  background: #ffd0d0;
  color: #611;
}

.hub-empty {
  text-align: center;
  padding: 40px 0;
  opacity: 0.85;
}
.hub-empty p {
  font-size: 1rem;
  margin-bottom: 16px;
}
/* ==== Pagination ==== */
.hub-pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  margin: 24px 0;
  font-size: 0.95rem;
}

.hub-page-info {
  opacity: 0.8;
}

.hub-pagination .ws-btn[disabled] {
  opacity: 0.4;
  cursor: not-allowed;
}

/* ---------- ScenarioHistory modal ---------- */
.sc-history-modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: min(640px, 90%);
  max-height: 80vh;
  overflow-y: auto;
  border-radius: 1rem;
  padding: 1.2rem 1.4rem;
  animation: fadeIn 0.2s ease;
}

.sc-history-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.8rem;
}

.sc-history-list li {
  border-bottom: 1px solid var(--glass-bdr);
  padding: 0.6rem 0;
}
.sc-history-list li:last-child {
  border-bottom: none;
}
.sc-h-title {
  font-weight: 600;
  font-size: 1.05em;
}
.sc-h-sub {
  opacity: 0.8;
  font-size: 0.9em;
  margin-top: 0.2rem;
}
.sc-h-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 0.4rem;
  font-size: 0.85em;
  opacity: 0.7;
}
.sc-h-actions {
  display: flex;
  gap: 0.4rem;
}
.sc-empty {
  text-align: center;
  opacity: 0.7;
  padding: 1rem 0;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translate(-50%, -46%); }
  to   { opacity: 1; transform: translate(-50%, -50%); }
}

.sc-running {
  margin-left: 10px;
  color: var(--ink-3);
  font-size: 13px;
}

.sc-sim-debug {
  margin-top: 12px;
  font-size: 13px;
  line-height: 1.4;
}
.sc-sim-debug b {
  color: var(--ink-2);
}
.sc-sim-header {
  border-bottom: 1px solid var(--glass-bdr);
  margin-bottom: 4px;
  font-weight: 600;
  padding-bottom: 2px;
}
.sc-sim-body p {
  margin: 2px 0;
}

/* ===========================
   ✨ Typewriter Animation
   =========================== */
.typewriter {
  white-space: pre-wrap;
  overflow: hidden;
  display: inline-block;
  animation: caretBlink 1s step-start infinite;
}

@keyframes caretBlink {
  50% {
    border-right: 2px solid var(--accent-color, #4af);
  }
}

/* ===============================
   🧠 AgentLogModal — Final Theme Match
   =============================== */

.agent-log-modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(6,10,20,0.55);
  backdrop-filter: blur(6px) saturate(120%);
  -webkit-backdrop-filter: blur(6px) saturate(120%);
  z-index: 2000;
  animation: fadeIn 0.25s ease;
}

[data-theme="light"] .agent-log-modal {
  background: rgba(6,10,20,0.35);
  backdrop-filter: blur(4px) saturate(115%);
}

/* modal card */
.agent-log-content {
  background: var(--panel-bg, rgba(24,26,34,.96));
  color: var(--text-color, #e9eef7);
  border: 1px solid var(--border-color, rgba(255,255,255,.14));
  border-radius: 16px;
  box-shadow: 0 22px 46px rgba(0,0,0,.35);
  width: min(900px, 86vw);
  max-height: 80vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

[data-theme="light"] .agent-log-content {
  background: rgba(255,255,255,.96);
  color: #0f1220;
  border-color: rgba(0,0,0,.12);
  box-shadow: 0 22px 46px rgba(0,0,0,.16);
}

/* header + footer */
.agent-log-header,
.agent-log-footer {
  padding: 0.75rem 1rem;
  background: var(--panel-bg-alt, rgba(0,0,0,.15));
  border-bottom: 1px solid var(--border-color, rgba(255,255,255,.14));
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.agent-log-footer {
  border-top: 1px solid var(--border-color, rgba(255,255,255,.14));
  border-bottom: none;
  font-size: 0.85rem;
  color: var(--text-secondary, #aaa);
}

/* table */
.agent-log-table-wrap {
  flex: 1;
  overflow-y: auto;
  scroll-behavior: smooth;
}

.agent-log-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
}

.agent-log-table th,
.agent-log-table td {
  border-bottom: 1px solid var(--border-color, rgba(255,255,255,.12));
  padding: 0.5rem 0.75rem;
  vertical-align: top;
}

.agent-log-table th {
  background: var(--panel-bg-alt, rgba(255,255,255,.05));
  font-weight: 700;
  color: var(--text-secondary, #bbb);
  position: sticky;
  top: 0;
  backdrop-filter: blur(3px);
}

[data-theme="light"] .agent-log-table th {
  background: rgba(0,0,0,.05);
  color: #333;
}

.agent-log-table tr:nth-child(even) {
  background: rgba(255,255,255,0.03);
}
[data-theme="light"] .agent-log-table tr:nth-child(even) {
  background: rgba(0,0,0,0.03);
}

.agent-log-table td.corroded {
  color: #ff6b6b;
}

/* new-entry glow animation */
@keyframes rowPulse {
  from { background-color: rgba(122,92,244,.15); }
  to { background-color: transparent; }
}
.agent-log-table tr.new-entry {
  animation: rowPulse 1.2s ease-out;
}

/* smooth scrollbar */
.agent-log-table-wrap::-webkit-scrollbar {
  width: 8px;
}
.agent-log-table-wrap::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, rgba(140,150,170,.65), rgba(120,110,220,.55));
  border-radius: 10px;
}
[data-theme="light"] .agent-log-table-wrap::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, rgba(0,0,0,.2), rgba(0,0,0,.12));
}

/* close button hover */
.agent-log-header .ws-btn.danger:hover {
  background: rgba(255,75,75,.12);
}

























/* --- Workstation: top bar wrapper that respects the sidebar --- */
.ws-topbar{
  position: sticky;
  top: 12px;
  z-index: 50;
  /* The main area already sits to the right of the sidebar, so we
     just cap width to the content area and center it. */
  width: min(100%, var(--content-w));
  margin: 8px auto 16px;
}

/* Make the embedded nav fill the available main width */
.ws-topbar .pf-nav,
.ws-topbar .sc-nav-pretty{
  width: 100%;
}




/* ===== MBTI custom select ===== */
.ws-select{ display:flex; flex-direction:column; gap:6px; position:relative; }
.ws-select > span{ font-weight:600; font-size:.95rem; opacity:.9; }

.ws-dd-trigger{
  width:100%; text-align:left; padding:10px 36px 10px 12px;
  border:1px solid var(--glass-bdr, rgba(255,255,255,.14));
  background: rgba(18,22,30,.75); color:#E9EEF7;
  border-radius:12px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
}
[data-theme="light"] .ws-dd-trigger{
  background: rgba(255,255,255,.92); color:#0f1320; border-color: rgba(0,0,0,.12);
}
.ws-dd-trigger .chev{ position:relative; right:10px; top:50%; transform:translateY(-50%); opacity:.8; }

.ws-dd{
  position:absolute; left:0; right:0; margin-top:6px;
  max-height:220px; overflow:auto; z-index: 700;
  border:1px solid var(--glass-bdr, rgba(255,255,255,.14));
  border-radius:12px; backdrop-filter:saturate(120%) blur(6px);
  background: rgba(15,18,24,.96); color:#E9EEF7;
  box-shadow: 0 22px 46px rgba(0,0,0,.35);
}
[data-theme="light"] .ws-dd{
  background: rgba(255,255,255,.98); color:#0f1220; border-color: rgba(0,0,0,.12);
}

.ws-dd-opt{
  padding:10px 12px; cursor:pointer; transition: background .15s ease, color .15s ease;
}
.ws-dd-opt:hover{ background: rgba(122,92,244,.15); }
.ws-dd-opt.is-active{ background: rgba(122,92,244,.22); font-weight:700; }

/* Pretty, visible scrollbar JUST for this dropdown (overrides global hide) */
.ws-dd{ scrollbar-width: thin; scrollbar-color: rgba(122,92,244,.6) transparent; }
.ws-dd::-webkit-scrollbar{ width: 10px; }
.ws-dd::-webkit-scrollbar-track{ background: transparent; }
.ws-dd::-webkit-scrollbar-thumb{
  background: rgba(122,92,244,.55);
  border-radius: 8px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
.ws-dd:hover::-webkit-scrollbar-thumb{ background: rgba(108, 100, 141, 0.75); }



/* ===== Sidebar → Horizontal toolbar (≤720px) ===== */
@media (max-width: 720px) {
  /* Remove any left offset reserved for the permanent sidebar */
  .ws-page { padding-left: 0; }

  /* Hide the fixed-left version and show the mobile one */
  .ws-left-only { display: none; }
  .ws-mobile-after-nav { display: block; }

  /* Turn the sidebar inside the mobile container into a full-width toolbar */
  .ws-mobile-after-nav .ws-sidebar {
    position: static;
    inset: auto;
    width: 100%;
    height: auto;
    margin: 8px 0 12px;
    border-radius: 14px;
    background: var(--glass-bg);
    border: 1px solid var(--glass-bdr);
    box-shadow: var(--shadow, 0 6px 24px rgba(0,0,0,.25));
    z-index: 3;
  }

  /* Compact header area inside the mobile bar */
  .ws-mobile-after-nav .ws-side-head { display: none; }

  /* Make the scroll container natural height */
  .ws-mobile-after-nav .side-scroll {
    max-height: none;
    overflow: visible;
  }

  /* Search row as a toolbar */
  .ws-mobile-after-nav .ws-search {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    border-bottom: 1px solid var(--glass-bdr);
  }
  .ws-mobile-after-nav .ws-search input {
    flex: 1 1 auto;
    height: 38px;
  }

  /* Agents list under the toolbar — neat grid */
  .ws-mobile-after-nav .ws-agent-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 10px;
    padding: 10px 12px 12px;
  }
}

/* Desktop / tablet: keep the original sidebar, hide the mobile copy */
@media (min-width: 721px) {
  .ws-left-only { display: block; }
  .ws-mobile-after-nav { display: none; }
}
/* === FINAL mobile override for the sidebar (≤720px) — keep at the very end === */
@media (max-width: 720px) {
  /* 0) Never reserve space for a fixed sidebar on mobile */
  .ws-page { --sidebar-w: 0px !important; padding-left: 0 !important; } /* :contentReference[oaicite:1]{index=1} */

  /* 1) Hide the fixed-left copy; show the mobile one if you render both */
  .ws-left-only { display: none !important; }                               /* :contentReference[oaicite:2]{index=2} */
  .ws-mobile-after-nav { display: block !important; }                       /* :contentReference[oaicite:3]{index=3} */

  /* 2) Make ANY sidebar full-width, even if not inside .ws-mobile-after-nav */
  .ws-sidebar {
    position: static !important;
    inset: auto !important;
    width: 100% !important;
    max-width: none !important;     /* cancel card caps */
    transform: none !important;
    height: auto !important;
    margin: 10px 0 14px !important;
    border-radius: 14px !important;
  }

  /* If you render the mobile wrapper, this also styles it nicely */
  .ws-mobile-after-nav .ws-sidebar {                                       /* :contentReference[oaicite:4]{index=4} */
    box-shadow: var(--shadow, 0 6px 24px rgba(0,0,0,.25));
    background: var(--glass-bg);
    border: 1px solid var(--glass-bdr);
  }

  /* 3) Remove the «» toggle on mobile */
  .ws-toggle-exp { display: none !important; }                             /* :contentReference[oaicite:5]{index=5} */

  /* 4) Compact spacing so items aren’t far apart */
  .ws-side-top { padding: 10px 12px 6px !important; }
  .ws-searchbar { padding: 8px 12px !important; border-top: 1px solid var(--glass-bdr); border-bottom: 1px solid var(--glass-bdr); } /* :contentReference[oaicite:6]{index=6} */
  .ws-side-section.agents { padding: 8px 12px 10px !important; }           /* :contentReference[oaicite:7]{index=7} */

  /* 5) Limit agent list height + pretty scrollbar */
  .ws-agent-list{
    max-height: min(320px, 45vh) !important;
    overflow: auto !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 8px !important;
    padding-right: 2px !important;                                         /* :contentReference[oaicite:8]{index=8} */
  }
  .ws-agent-pill { padding: 8px 10px !important; min-height: 44px !important; gap: 10px !important; }
}
/* Scrollbar cosmetics for that list */
.ws-agent-list{ scrollbar-width: thin; scrollbar-color: rgba(122,92,244,.6) transparent; }  /* :contentReference[oaicite:9]{index=9} */
.ws-agent-list::-webkit-scrollbar{ width: 10px; }
.ws-agent-list::-webkit-scrollbar-track{ background: transparent; }
.ws-agent-list::-webkit-scrollbar-thumb{
  background: rgba(122,92,244,.55); border-radius: 8px; border: 2px solid transparent; background-clip: padding-box;
}
.ws-agent-list:hover::-webkit-scrollbar-thumb{ background: rgba(108,100,141,.75); }         /* :contentReference[oaicite:10]{index=10} */


/* ----- 720px: compact spacing + 3-row agent list ----- */
@media (max-width: 720px){
  /* tighter overall card spacing */
  .ws-mobile-after-nav .ws-sidebar{ margin: 6px 0 10px; }

  /* search row: smaller padding + input height */
  .ws-mobile-after-nav .ws-search{
    padding: 6px 10px;
    gap: 6px;
  }
  .ws-mobile-after-nav .ws-search input{ height: 32px; }

  /* section paddings */
  .ws-mobile-after-nav .ws-side-section.agents{ padding: 6px 10px 8px; }

  /* agent list: ~3 rows visible, then scroll */
  .ws-mobile-after-nav .ws-agent-list{
    padding: 6px 10px 8px;
    gap: 6px;                    /* was 10px */
    max-height: 176px;           /* ≈ 3 rows; change to 120–140px for ~2 rows */
    overflow: auto;
  }

  /* each row more compact but still tappable */
  .ws-mobile-after-nav .ws-agent-pill{
    padding: 6px 8px;            /* was 8–10px */
    min-height: 40px;            /* was 44px */
    gap: 8px;
    line-height: 1.25;
  }
  .ws-mobile-after-nav .ws-agent-pill .name{ line-height: 1.2; }

  /* smaller action buttons */
  .ws-mobile-after-nav .ws-mini-btn{
    height: 28px;
    padding: 3px 9px;
  }
}



/* ===== 720px: compact agent rows ===== */
@media (max-width: 720px){

  /* 1) Overall list density (how many rows fit) */
  .ws-mobile-after-nav .ws-agent-list{
    gap: 6px;                 /* space between rows (was 10px) */
    max-height: 160px;        /* ≈ 3 rows; use ~132px for ≈2 rows */
    padding: 6px 10px 8px;
    overflow: auto;
  }

  /* 2) Row height (main knob) */
  .ws-mobile-after-nav .ws-agent-pill{
    min-height: 36px;         /* was 40–44px */
    padding: 6px 8px;         /* reduce vertical padding */
    gap: 8px;                 /* space between icon, name, buttons */
    line-height: 1.25;
  }

  /* 3) Icon size */
  .ws-mobile-after-nav .ws-agent-pill .avatar{ 
    width: 18px; height: 18px; 
    display: grid; place-items: center;
  }
  .ws-mobile-after-nav .ws-agent-pill .avatar svg{
    width: 16px; height: 16px;
  }

  /* 4) Name text size */
  .ws-mobile-after-nav .ws-agent-pill .name,
  .ws-mobile-after-nav .ws-agent-pill .lbl{   /* fallback if your class is .lbl */
    font-size: 13px;          /* was ~14–16px */
    line-height: 1.25;
  }

  /* 5) Action buttons size */
  .ws-mobile-after-nav .ws-mini-btn{
    height: 26px;             /* was ~30px */
    padding: 2px 8px;
    font-size: 12px;
    border-radius: 10px;
  }
}






/* pretty scrollbar just for the list (keeps global scrollbars hidden) */
.ws-mobile-after-nav .ws-agent-list{ scrollbar-width: thin; scrollbar-color: rgba(122,92,244,.6) transparent; }
.ws-mobile-after-nav .ws-agent-list::-webkit-scrollbar{ width: 10px; }
.ws-mobile-after-nav .ws-agent-list::-webkit-scrollbar-track{ background: transparent; }
.ws-mobile-after-nav .ws-agent-list::-webkit-scrollbar-thumb{
  background: rgba(122,92,244,.55);
  border-radius: 8px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
.ws-mobile-after-nav .ws-agent-list:hover::-webkit-scrollbar-thumb{ background: rgba(108,100,141,.75); }



/* MBTI select: center the caret and keep it pretty in dark/light */
.ws-form select[name="agentpersonality"]{
  -webkit-appearance: none; -moz-appearance: none; appearance: none; /* hide native arrow */
  padding-right: 44px;                 /* room for our chevron */
  min-height: 42px;                    /* consistent height */
  line-height: normal;                 /* avoid top-hugging arrows on Windows */
  background-repeat: no-repeat;
  background-position: right 12px center;  /* ✅ vertical center */
  background-size: 16px 16px;
}

/* ===== Scenario stage: hide the Workstation sidebar completely ===== */
.ws-page.no-sidebar .ws-left-only,
.ws-page.no-sidebar .ws-mobile-after-nav,
.ws-page.no-sidebar .ws-sidebar {
  display: none !important;
}

/* Remove any reserved left space on mobile while in Scenario */
@media (max-width: 720px) {
  .ws-page.no-sidebar {
    padding-left: 0 !important;
    --sidebar-w: 0px !important;
  }
}

/* ===== Gate the mobile toolbar so it only applies when NOT in Scenario ===== */
@media (max-width: 720px) {
  .ws-page:not(.no-sidebar) .ws-left-only { display: none !important; }
  .ws-page:not(.no-sidebar) .ws-mobile-after-nav { display: block !important; }

  /* (Optional) if you need the styling too, keep it scoped: */
  .ws-page:not(.no-sidebar) .ws-sidebar {
    position: static !important;
    inset: auto !important;
    width: 100% !important;
    height: auto !important;
    margin: 8px 0 12px;
    border-radius: 14px;
    background: var(--glass-bg);
    border: 1px solid var(--glass-bdr);
    box-shadow: var(--shadow, 0 6px 24px rgba(0,0,0,.25));
  }
}






/* Ensure the modal can have a sticky footer */
.ws-modal {
  display: flex;
  flex-direction: column;
  max-height: 88vh;
  overflow: hidden;
}

/* Form scrolls; footer stays put */
.ws-modal .ws-form {
  flex: 1 1 auto;
  overflow: auto;
  padding-bottom: 8px; /* room above the bar */
}

/* Shared footer-bar look (dark glass that works in both themes) */
.ws-modal .ws-modal-actions,
.ws-card .modal-actions {
  position: sticky;
  bottom: 0;
  display: flex;
  justify-content: flex-end;
  gap: 10px;

  /* make the bar span full card width */
  padding: 12px 18px;
  margin: 8px -18px -18px;         /* pull into the card padding */
  border-top: 1px solid var(--glass-bdr);
  border-bottom-left-radius: 14px;
  border-bottom-right-radius: 14px;

  /* its own background so underlying content doesn't show through */
  background: rgb(16, 20, 32);
  backdrop-filter: blur(10px) saturate(1.15);
  -webkit-backdrop-filter: blur(10px) saturate(1.15);
  box-shadow: 0 -6px 16px rgba(0,0,0,.22) inset;
}

/* Optional: lighter footer when your app is in light theme */
html[data-theme="light"] .ws-modal .ws-modal-actions,
html[data-theme="light"] .ws-card .modal-actions {
  background: rgba(255, 255, 255, .86);
}















/* Backdrop (doesn't cover sidebar) */
.ws-backdrop-content{
  position: fixed;
  inset: 0 0 0 var(--sidebar-w);
  z-index: 8000;
  background: rgba(6,10,20,.50);           /* default = dark */
  backdrop-filter: blur(3px) saturate(120%);
  -webkit-backdrop-filter: blur(3px) saturate(120%);
}

/* ✅ Light mode: use a stronger mask + the right selector */
[data-theme="light"] .ws-backdrop-content{
  background: rgba(6,10,20,.32) !important; /* slightly darker so content pops */
  backdrop-filter: blur(2px) saturate(115%) !important;
  -webkit-backdrop-filter: blur(2px) saturate(115%) !important;
}

/* History dialog surface */
.sc-history-modal{ z-index: 90000; }

/* ✅ Light mode surface & text for the dialog */
[data-theme="light"] .sc-history-modal{
  background: rgba(255,255,255,.98) !important;
  color: #0f1220 !important;
  border: 1px solid rgba(0,0,0,.12) !important;
  box-shadow: 0 22px 46px rgba(0,0,0,.20) !important;
}

/* Make sure headings/body inside are legible in light */
[data-theme="light"] .sc-history-modal h3,
[data-theme="light"] .sc-history-modal p,
[data-theme="light"] .sc-history-modal div{
  color:#0f1220 !important;
}


/* 🎞 Smooth replay motion */
.sc-node {
  transition: left 0.6s ease, top 0.6s ease;
}
/* 💭 Emotional pulse */
.sc-node.pulse {
  animation: pulseColor 1s ease;
}
@keyframes pulseColor {
  0%   { box-shadow: 0 0 0 0 rgba(255, 174, 66, 0.6); }
  100% { box-shadow: 0 0 0 20px rgba(255, 174, 66, 0); }
}
